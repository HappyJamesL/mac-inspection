## 完善统一操作反馈信息显示方案

### 问题分析

基于之前的方案，结合用户的完善意见，当前需要解决：

1. **缺少Layout状态提示**：当页面没有layout时，没有明确的提示信息
2. **信息显示时长不一致**：错误或缺失信息需要延长显示时间至3秒
3. **统一操作反馈**：整合所有操作信息到右上角"Ready"区域

### 解决方案

修改 `InspectionView.vue` 和 `CanvasStage.vue` 文件，实现统一的操作反馈信息显示，包含layout状态提示和优化的显示时长。

### 具体修改点

#### 1. CanvasStage组件修改

**添加layout状态事件**：
```vue
// 在CanvasStage.vue中添加
const emit = defineEmits(['add-defect', 'layout-status-change']);

// 在loadPanelData函数中添加
if (data.panels && data.panels.length > 0) {
  // 有有效的layout数据
  emit('layout-status-change', true);
} else {
  // 没有有效的layout数据
  emit('layout-status-change', false);
}

// 在drawBackground函数中添加
if (glassConfig.panels.length === 0) {
  emit('layout-status-change', false);
}
```

#### 2. InspectionView组件修改

**添加layout状态管理**：
```vue
// 在状态变量中添加
const hasLayout = ref(true);

// 在CanvasStage组件中监听事件
<CanvasStage
  ...
  @layout-status-change="hasLayout = $event"
/>
```

**修改右上角显示逻辑**：
```vue
// 右上角显示区域
<div class="text-xs flex items-center space-x-3">
  <!-- Layout状态提示 -->
  <span v-if="!hasLayout" class="text-yellow-600 font-bold">
    <i class="fa-solid fa-exclamation-triangle"></i> 缺Layout
  </span>
  
  <!-- 保存成功提示 -->
  <span v-else-if="autoSaveStatus" class="text-green-600 font-bold">
    <i class="fa-solid fa-check"></i> 保存成功
  </span>
  
  <!-- 错误或缺失信息 -->
  <div v-else-if="saveMessage" :class="[
    'flex items-center font-bold px-2 py-1 rounded',
    saveMessageType === 'success' ? 'bg-green-100 text-green-700' : 
    saveMessageType === 'error' ? 'bg-red-100 text-red-700' : 'bg-blue-100 text-blue-700'
  ]">
    <i v-if="saveMessageType === 'success'" class="fa-solid fa-check-circle mr-1"></i>
    <i v-else-if="saveMessageType === 'error'" class="fa-solid fa-exclamation-circle mr-1"></i>
    <span>{{ saveMessage }}</span>
  </div>
  
  <!-- 默认状态 -->
  <span v-else>Ready</span>
</div>
```

**调整信息显示时长**：
```vue
// 统一的信息显示函数
const showMessage = (message, type = 'success', duration = 1500) => {
  saveMessage.value = message;
  saveMessageType.value = type;
  
  // 错误或缺失信息，显示时间延长到3秒
  const displayDuration = type === 'error' ? 3000 : duration;
  
  setTimeout(() => {
    saveMessage.value = '';
  }, displayDuration);
};

// 修改现有调用，使用统一函数
// 保存成功
showMessage('成功保存缺陷', 'success');

// 保存失败
showMessage(`保存失败: ${error}`, 'error');

// 删除成功
showMessage('缺陷删除成功', 'success');

// 删除失败
showMessage(`删除失败: ${error}`, 'error');
```

#### 3. 完善使用场景

**保存缺陷**：
```vue
// 所有缺陷保存成功
if (failedCount === 0) {
  autoSaveStatus.value = true;
  setTimeout(() => {
    autoSaveStatus.value = false;
  }, 1500);
} else {
  // 有缺陷保存失败
  showMessage(`保存成功 ${savedCount} 个，失败 ${failedCount} 个`, 'error');
}
```

**删除缺陷**：
```vue
// 删除成功
showMessage('缺陷删除成功', 'success');

// 删除失败
showMessage(`删除失败: ${error}`, 'error');
```

**复制缺陷**：
```vue
// 复制成功
showMessage('成功复制缺陷', 'success');

// 复制失败
showMessage('复制缺陷失败', 'error');
```

### 预期效果

1. **Layout状态提示**：
   - 有layout时：正常显示操作信息
   - 无layout时：显示"缺Layout"提示
   - 提示使用黄色字体和警告图标，醒目可见

2. **统一操作反馈**：
   - 所有操作信息整合到右上角
   - 显示优先级：Layout提示 > 错误信息 > 成功信息 > Ready状态
   - 清晰区分不同类型的信息

3. **优化显示时长**：
   - 成功信息：1.5秒
   - 错误信息：3秒
   - Layout提示：持续显示，直到layout加载完成
   - 自动隐藏，无需用户操作

### 技术实现

1. **事件驱动**：CanvasStage组件通过事件通知layout状态
2. **响应式设计**：使用Vue的响应式系统管理状态
3. **统一函数**：使用showMessage函数统一管理信息显示
4. **样式优化**：使用Tailwind CSS实现美观的样式
5. **自动隐藏**：使用setTimeout实现自动隐藏机制

### 实施步骤

1. 修改 `CanvasStage.vue`，添加layout状态事件
2. 修改 `InspectionView.vue`，添加layout状态管理
3. 修改右上角显示逻辑，整合所有信息
4. 实现统一的showMessage函数
5. 调整信息显示时长
6. 测试所有场景：
   - 有layout时的操作反馈
   - 无layout时的提示显示
   - 成功操作的信息显示
   - 错误操作的信息显示
   - 不同类型信息的显示时长

### 关键代码实现

```vue
// CanvasStage.vue - 添加事件
const emit = defineEmits(['add-defect', 'layout-status-change']);

// 通知layout状态
const notifyLayoutStatus = () => {
  emit('layout-status-change', glassConfig.panels.length > 0);
};

// 在loadPanelData和drawBackground中调用
notifyLayoutStatus();

// InspectionView.vue - 接收事件
<CanvasStage
  ...
  @layout-status-change="hasLayout = $event"
/>

// 统一信息显示函数
const showMessage = (message, type = 'success', duration = 1500) => {
  saveMessage.value = message;
  saveMessageType.value = type;
  const displayDuration = type === 'error' ? 3000 : duration;
  setTimeout(() => {
    saveMessage.value = '';
  }, displayDuration);
};
```

### 预期效果验证

- ✅ 有layout时正常显示操作信息
- ✅ 无layout时显示"缺Layout"提示
- ✅ 成功信息显示1.5秒
- ✅ 错误信息显示3秒
- ✅ 所有信息统一在右上角显示
- ✅ 信息类型清晰区分
- ✅ 自动隐藏，无需用户操作

通过以上修改，将实现完善的统一操作反馈信息显示，包含layout状态提示和优化的显示时长，提供清晰、一致的用户体验。