# Python 3.10 迁移到 Python 3.9 计划

## 可行性分析

经过检查，项目的主要依赖库都支持 Python 3.9：
- fastapi 0.104.1：支持 Python 3.6+
- sqlalchemy 2.0.34：支持 Python 3.9
- shapely 2.0.6：支持 Python 3.9
- pydantic 1.10.15：支持 Python 3.6+
- 其他依赖库如 uvicorn、python-multipart 等也都支持 Python 3.9

## 需要修改的内容

### 1. 语法修改
项目中使用了 Python 3.10 特定的联合类型语法 `|`，需要修改为 Python 3.9 支持的 `Union` 类型：

- 文件：`app/api/routes/auth.py`
  - 第 35 行：`def authenticate_user(db: Session, username: str, password: str) -> User | None:`
    - 修改为：`def authenticate_user(db: Session, username: str, password: str) -> Union[User, None]:`
  - 第 45 行：`def create_access_token(data: dict, expires_delta: timedelta | None = None):`
    - 修改为：`def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):`
  - 需要在文件顶部添加导入：`from typing import Union, Optional`

### 2. 虚拟环境
- 删除现有的 `.venv310` 虚拟环境（可选）
- 创建新的 Python 3.9 虚拟环境：`python3.9 -m venv .venv39`
- 激活虚拟环境：
  - Windows：`.venv39\Scripts\activate`
  - Linux/Mac：`source .venv39/bin/activate`
- 安装依赖：`pip install -r requirements.txt`

### 3. 验证迁移
- 运行项目：`uvicorn main:app --reload`
- 运行测试：`pytest`

## 迁移步骤

1. 修改代码中的 Python 3.10 特定语法
2. 创建新的 Python 3.9 虚拟环境
3. 安装依赖
4. 验证项目运行正常
5. 验证测试通过

## 注意事项

- 确保服务器上已经安装了 Python 3.9
- 迁移前备份代码和数据
- 迁移后进行充分的测试，确保所有功能正常工作